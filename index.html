<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>İş Süreç Takip - Excel Tabanlı</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Carbon CSS -->
  <link rel="stylesheet" href="https://unpkg.com/carbon-components/css/carbon-components.min.css">
  <!-- SheetJS -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #table-container { max-height: 400px; overflow: auto; margin-bottom: 20px; }
    .bx--btn { margin-right: 10px; }
  </style>
</head>
<body>
  <h1>İş Süreç Takip Sistemi (Excel Tabanlı)</h1>
  <div>
    <input type="file" id="file-input" accept=".xls,.xlsx,.xlsm" />
    <button class="bx--btn bx--btn--primary" onclick="loadFile()">Excel'i Yükle</button>
  </div>

  <div id="table-container"></div>

  <h2>Yeni Kayıt Ekle</h2>
  <form id="add-form">
    <label>ID: <input type="text" id="f-id" required /></label>
    <label>İş Başlığı: <input type="text" id="f-baslik" required /></label>
    <label>İş Tanımı: <input type="text" id="f-tanim" /></label>
    <label>Sorumlu: <input type="text" id="f-sorumlu" /></label>
    <label>Başlangıç Tarihi: <input type="date" id="f-baslangic" /></label>
    <label>Bitiş Tarihi: <input type="date" id="f-bitis" /></label>
    <label>Durum: <input type="text" id="f-durum" /></label>
    <label>Öncelik: <input type="text" id="f-oncelik" /></label>
    <label>Not: <input type="text" id="f-not" /></label>
    <label>Hatırlatma (gün): <input type="number" id="f-hatirlatma" /></label>
    <label>İş Tamamlandı mı? <select id="f-tamamlandi"><option>EVET</option><option>HAYIR</option></select></label>
    <button type="submit" class="bx--btn bx--btn--secondary">Ekle</button>
  </form>

  <h2>Sorgula</h2>
  <label>Filtre (Sorumlu): <input type="text" id="filter-sorumlu" /></label>
  <button onclick="applyFilter()" class="bx--btn bx--btn--primary">Uygula</button>

  <script>
    let workbook, worksheet, data = [];
    const container = document.getElementById('table-container');

    function loadFile() {
      const inp = document.getElementById('file-input');
      if (!inp.files.length) return alert('Lütfen bir dosya seçin.');
      const reader = new FileReader();
      reader.onload = e => {
        workbook = XLSX.read(e.target.result, { type: 'binary' });
        worksheet = workbook.Sheets['TümVeriler'];
        data = XLSX.utils.sheet_to_json(worksheet, { defval: '' });
        renderTable(data);
      };
      reader.readAsBinaryString(inp.files[0]);
    }

    function renderTable(arr) {
      container.innerHTML = '';
      if (!arr.length) return;
      const tbl = document.createElement('table');
      tbl.className = 'bx--data-table bx--data-table--zebra';
      const header = document.createElement('thead');
      const cols = Object.keys(arr[0]);
      header.innerHTML = '<tr>' + cols.map(c=>`<th>${c}</th>`).join('') + '</tr>';
      tbl.appendChild(header);
      const body = document.createElement('tbody');
      arr.forEach(row => {
        const tr = document.createElement('tr');
        cols.forEach(c => {
          const td = document.createElement('td'); td.textContent = row[c]; tr.appendChild(td);
        });
        body.appendChild(tr);
      });
      tbl.appendChild(body);
      container.appendChild(tbl);
    }

    document.getElementById('add-form').addEventListener('submit', e => {
      e.preventDefault();
      const newRow = {
        'ID': document.getElementById('f-id').value,
        'İş Başlığı': document.getElementById('f-baslik').value,
        'İş Tanımı': document.getElementById('f-tanim').value,
        'Sorumlu': document.getElementById('f-sorumlu').value,
        'Başlangıç Tarihi': document.getElementById('f-baslangic').value,
        'Bitiş Tarihi': document.getElementById('f-bitis').value,
        'Durum': document.getElementById('f-durum').value,
        'Öncelik': document.getElementById('f-oncelik').value,
        'Not': document.getElementById('f-not').value,
        'Hatırlatma Aralığı (gün)': document.getElementById('f-hatirlatma').value,
        'İş Tamamlandı mı?': document.getElementById('f-tamamlandi').value
      };
      data.push(newRow);
      renderTable(data);
      e.target.reset();
    });

    function applyFilter() {
      const key = document.getElementById('filter-sorumlu').value.toLowerCase();
      const filtered = data.filter(row => row['Sorumlu'].toLowerCase().includes(key));
      renderTable(filtered);
    }
  </script>
</body>
</html>
