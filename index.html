<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Ä°ÅŸ Takip</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: #f4f6f9;
    }
    header {
      background: #2c3e50;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 1.8em;
    }
    nav {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      background: #ecf0f1;
      padding: 10px 0;
    }
    nav button {
      margin: 5px;
      padding: 10px 16px;
      border: none;
      background-color: #3498db;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    nav button:hover {
      background-color: #2980b9;
    }
    .tab {
      display: none;
      padding: 20px;
      max-width: 1200px;
      margin: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background: white;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: left;
    }
    th {
      background-color: #bdc3c7;
    }
    .visible {
      display: block;
    }
    canvas {
      margin-top: 20px;
      background: white;
      border-radius: 8px;
      padding: 15px;
    }
    .footer {
      text-align: center;
      padding: 10px;
      font-size: 0.9em;
      color: #999;
    }
  </style>
</head>
<body>

<header>Ä°ÅŸ Takip Sistemi</header>

<nav>
  <button onclick="showTab('ana')">Ana Tablo</button>
  <button onclick="showTab('analiz')">Analiz</button>
  <button onclick="showTab('form')">Veri GiriÅŸi</button>
  <button onclick="fetchData()">Yenile ðŸ”„</button>
</nav>

<section id="ana" class="tab visible">
  <h2>Ana Tablo</h2>
  <div>
    <label>Filtre: </label>
    <input type="text" id="searchBox" oninput="filterTable()" placeholder="BaÅŸlÄ±k / Sorumlu / Durum...">
    <button onclick="clearFilter()">Temizle</button>
  </div>
  <table id="dataTable">
    <thead>
      <tr>
        <th>Zaman</th><th>Ä°ÅŸ BaÅŸlÄ±ÄŸÄ±</th><th>Ä°ÅŸ TanÄ±mÄ±</th><th>Sorumlu</th>
        <th>BaÅŸlangÄ±Ã§</th><th>BitiÅŸ</th><th>Durum</th><th>Ã–ncelik</th><th>Not</th><th>HatÄ±rlatma</th><th>Ä°ÅŸlem</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<section id="analiz" class="tab">
  <h2>Analizler</h2>
  <canvas id="chart1"></canvas>
  <canvas id="chart2"></canvas>
</section>

<section id="form" class="tab">
  <h2>Yeni KayÄ±t</h2>
  <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSeO5gyy2PE4zRvj_OUhTE00M63M_xezHDMtjsdU4FcOWqc9lw/viewform?embedded=true" width="100%" height="1700" frameborder="0" marginheight="0" marginwidth="0">YÃ¼kleniyorâ€¦</iframe>
</section>

<div class="footer">Â© 2025 GS</div>

<script>
  const sheetID = '1lhW-0Gn38DH-GYPOHZkvZvfL8hsaNYj6vyA_Rnli7EU';
  const sheetName = 'Form YanÄ±tlarÄ± 1';
  const query = encodeURIComponent('SELECT *');
  const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?sheet=${sheetName}&tq=${query}`;

  function showTab(id) {
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('visible'));
    document.getElementById(id).classList.add('visible');
  }

  function fetchData() {
    fetch(url)
      .then(res => res.text())
      .then(rep => {
        const data = JSON.parse(rep.substr(47).slice(0, -2));
        const tbody = document.querySelector("#dataTable tbody");
        tbody.innerHTML = "";
        const durumlar = {}, sorumlular = {};

        data.table.rows.forEach(row => {
          const c = row.c.map(x => x?.v || '');
          const [zaman, baslik, tanim, sorumlu, basla, bitis, durum, oncelik, notlar, hatirlat] = c;
          const tr = document.createElement("tr");

          const now = new Date();
          let bitisDate = new Date(bitis);
          if (bitis.includes(".")) {
            const [g, a, y] = bitis.split(".");
            bitisDate = new Date(`${y}-${a}-${g}`);
          }
          if (bitisDate < now && durum !== 'TamamlandÄ±') {
            tr.style.backgroundColor = '#ffcccc';
          }

          [zaman, baslik, tanim, sorumlu, basla, bitis, durum, oncelik, notlar, hatirlat].forEach(txt => {
            const td = document.createElement("td");
            td.textContent = txt;
            tr.appendChild(td);
          });
          const tdEdit = document.createElement("td");
          tdEdit.innerHTML = "ðŸ–Š";
          tr.appendChild(tdEdit);
          tbody.appendChild(tr);

          durumlar[durum] = (durumlar[durum] || 0) + 1;
          sorumlular[sorumlu] = (sorumlular[sorumlu] || 0) + 1;
        });

        // Chart 1 - Durum
        new Chart(document.getElementById("chart1"), {
          type: 'pie',
          data: {
            labels: Object.keys(durumlar),
            datasets: [{
              data: Object.values(durumlar),
              backgroundColor: ['#27ae60', '#e67e22', '#e74c3c']
            }]
          }
        });

        // Chart 2 - Sorumlu
        new Chart(document.getElementById("chart2"), {
          type: 'bar',
          data: {
            labels: Object.keys(sorumlular),
            datasets: [{
              label: 'Ä°ÅŸ SayÄ±sÄ±',
              data: Object.values(sorumlular),
              backgroundColor: '#2980b9'
            }]
          }
        });
      });
  }

  function filterTable() {
    const val = document.getElementById("searchBox").value.toLowerCase();
    document.querySelectorAll("#dataTable tbody tr").forEach(tr => {
      const text = tr.textContent.toLowerCase();
      tr.style.display = text.includes(val) ? "" : "none";
    });
  }

  function clearFilter() {
    document.getElementById("searchBox").value = "";
    filterTable();
  }

  fetchData();
</script>
</body>
</html>
