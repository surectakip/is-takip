
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>İş Takip Sistemi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js">
function formatDate(raw) {
  if (typeof raw === "string" && raw.startsWith("Date(")) {
    const parts = raw.match(/\d+/g).map(Number);
    const d = new Date(parts[0], parts[1], parts[2], parts[3] || 0, parts[4] || 0);
    return d.toLocaleString("tr-TR");
  }
  return raw;
}

// Sayfa yüklendiğinde ilk veri çekimi
fetchData();
</script>


  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
    nav button { margin: 5px; padding: 10px 15px; font-size: 16px; }
    .hidden { display: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #eee; }
    iframe { width: 100%; height: 1000px; border: none; margin-top: 20px; }
    #loginScreen { max-width: 400px; margin: 100px auto; text-align: center; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px #ccc; }
  </style>
</head>
<body onload="checkLogin()">

<!-- Giriş ekranı -->
<div id="loginScreen">
  <h2>🔐 Giriş Yap</h2>
  <input type="password" id="loginPass" placeholder="Şifre girin" />
  <button onclick="login()">Giriş</button>
  <p id="errorMsg" style="color:red;"></p>
</div>

<!-- Uygulama -->
<div id="appContent" class="hidden">
  <h1>📋 İş Takip Sistemi</h1>

  <nav>
    <button onclick="showTab('tablo')">📋 Ana Tablo</button>
    <button onclick="showTab('grafik')">📊 Analiz</button>
    <button onclick="showTab('form')">📝 Veri Girişi</button>
  </nav>

  <!-- Sekme: Ana Tablo -->
  <section id="tablo">
    <table id="dataTable">
      <thead>
        <tr><th>Zaman</th><th>İş Başlığı</th><th>İş Tanımı</th><th>Sorumlu</th><th>Başlangıç</th><th>Bitiş</th><th>Durum</th><th>Öncelik</th><th>Not</th><th>Hatırlatma</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Sekme: Grafik -->
  <section id="grafik" class="hidden">
    <canvas id="chartBekleyen"></canvas>
    <canvas id="chartTamamlanmamis"></canvas>
    <h3>Süresi Geçmiş İşler</h3>
    <table id="lateTable"><thead><tr><th>Başlık</th><th>Sorumlu</th><th>Bitiş</th><th>Durum</th></tr></thead><tbody></tbody></table>
  </section>

  <!-- Sekme: Form -->
  <section id="form" class="hidden">
    <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSeO5gyy2PE4zRvj_OUhTE00M63M_xezHDMtjsdU4FcOWqc9lw/viewform?embedded=true">Yükleniyor…</iframe>
  </section>
</div>

<script>
const correctPassword = "sl620(Ku)";
function login() {
  const input = document.getElementById("loginPass").value;
  if (input === correctPassword) {
    localStorage.setItem("access", "true");
    showApp();
  } else {
    document.getElementById("errorMsg").textContent = "Hatalı şifre!";
  }
}
function checkLogin() {
  const ok = localStorage.getItem("access");
  if (ok === "true") showApp();
}
function showApp() {
  document.getElementById("loginScreen").style.display = "none";
  document.getElementById("appContent").classList.remove("hidden");
}
function showTab(id) {
  ['tablo','grafik','form'].forEach(tab => {
    document.getElementById(tab).classList.add('hidden');
  });
  document.getElementById(id).classList.remove('hidden');
}

const url = "https://docs.google.com/spreadsheets/d/1lhW-0Gn38DH-GYPOHZkvZvfL8hsaNYj6vyA_Rnli7EU/gviz/tq?sheet=Form Yanıtları 1&tq=SELECT%20*";
fetch(url)
  .then(res => res.text())
  .then(rep => {
    const data = JSON.parse(rep.substr(47).slice(0, -2));
    const tbody = document.querySelector("#dataTable tbody");
    const lateBody = document.querySelector("#lateTable tbody");
    const now = new Date();

    const bekleyen = {}, tamamlanmamis = {};

    data.table.rows.forEach(row => {
      const cells = row.c.map(cell => cell?.v || '');
      const tr = document.createElement("tr");
      cells.forEach(text => {
        const td = document.createElement("td");
        td.textContent = formatDate(text);
        tr.appendChild(td);
      });
      tbody.appendChild(tr);

          durumSayac[durum] = (durumSayac[durum] || 0) + 1;
          if (baslangic) {
            const tarih = baslangic.split(" ")[0];
            baslamaTarihleri[tarih] = (baslamaTarihleri[tarih] || 0) + 1;
          }

      const [_, baslik, __, sorumlu, ___, bitis, durum] = cells;
      const tarih = new Date(bitis);
      if (durum !== "Tamamlandı") {
        tamamlanmamis[sorumlu] = (tamamlanmamis[sorumlu] || 0) + 1;
        if (!isNaN(tarih) && tarih < now) {
          const ltr = document.createElement("tr");
          ltr.innerHTML = `<td>${baslik}</td><td>${sorumlu}</td><td>${bitis}</td><td>${durum}</td>`;
          lateBody.appendChild(ltr);
        }
      }
      if (durum === "Beklemede" || durum === "Devam Ediyor") {
        bekleyen[sorumlu] = (bekleyen[sorumlu] || 0) + 1;
      }
    });

    new Chart(document.getElementById('chartBekleyen'), {
      type: 'bar',
      data: {
        labels: Object.keys(bekleyen),
        datasets: [{ label: 'Bekleyen İşler', data: Object.values(bekleyen), backgroundColor: 'orange' }]
      }
    });

    new Chart(document.getElementById('chartTamamlanmamis'), {
      type: 'bar',
      data: {
        labels: Object.keys(tamamlanmamis),
        datasets: [{ label: 'Tamamlanmayan İşler', data: Object.values(tamamlanmamis), backgroundColor: 'crimson' }]
      }
    });
  });

function formatDate(raw) {
  if (typeof raw === "string" && raw.startsWith("Date(")) {
    const parts = raw.match(/\d+/g).map(Number);
    const d = new Date(parts[0], parts[1], parts[2], parts[3] || 0, parts[4] || 0);
    return d.toLocaleString("tr-TR");
  }
  return raw;
}

// Sayfa yüklendiğinde ilk veri çekimi
fetchData();
</script>


</body>
</html>
