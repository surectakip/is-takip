<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>İş Süreç Takip - Mobil Uyumlu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Carbon CSS (isteğe bağlı) -->
  <link rel="stylesheet" href="https://unpkg.com/carbon-components/css/carbon-components.min.css">
  <style>
    body { margin:0; font-family: Arial, sans-serif; padding:10px; }
    header { background:#2c3e50; color:white; padding:15px; text-align:center; }
    form, .filter-section { margin:10px 0; }
    input, select, button { width:100%; padding:8px; margin:5px 0; box-sizing:border-box; }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th, td { border:1px solid #ddd; padding:8px; }
    th { background:#f4f4f4; }
    @media (min-width:600px) { input, select, button { width:auto; display:inline-block; margin-right:5px; } }
  </style>
</head>
<body>
  <header><h1>İş Süreç Takip</h1></header>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script>
    // TODO: Replace with your Firebase project config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const collection = db.collection('isTakip');

    // Add record
    async function addRecord(e) {
      e.preventDefault();
      const data = {
        isAdi: document.getElementById('f-isAdi').value.trim(),
        daire: document.getElementById('f-daire').value.trim(),
        isTanim: document.getElementById('f-tanim').value.trim(),
        baslangic: document.getElementById('f-baslangic').value,
        bitis: document.getElementById('f-bitis').value,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      };
      await collection.add(data);
      document.getElementById('add-form').reset();
      loadRecords();
    }

    // Load and display records with optional filters
    async function loadRecords() {
      const isFilter = document.getElementById('filter-isAdi').value.trim().toLowerCase();
      const daireFilter = document.getElementById('filter-daire').value.trim().toLowerCase();

      let query = collection.orderBy('timestamp', 'desc');
      const snapshot = await query.get();

      const tableBody = document.getElementById('records');
      tableBody.innerHTML = '';

      snapshot.docs.forEach(doc => {
        const r = doc.data();
        if ((isFilter && !r.isAdi.toLowerCase().includes(isFilter)) ||
            (daireFilter && !r.daire.toLowerCase().includes(daireFilter))) {
          return;
        }
        const tr = document.createElement('tr');
        ['isAdi','daire','isTanim','baslangic','bitis'].forEach(key => {
          const td = document.createElement('td');
          td.textContent = r[key] || '';
          tr.appendChild(td);
        });
        tableBody.appendChild(tr);
      });
    }

    window.addEventListener('load', () => {
      document.getElementById('add-form').addEventListener('submit', addRecord);
      document.getElementById('apply-filter').addEventListener('click', loadRecords);
      loadRecords();
    });
  </script>

  <!-- Ekleme Formu -->
  <form id="add-form">
    <input id="f-isAdi" placeholder="İş Adı" required />
    <input id="f-daire" placeholder="Daire" required />
    <input id="f-tanim" placeholder="İş Tanımı" />
    <input type="date" id="f-baslangic" placeholder="Başlangıç Tarihi" />
    <input type="date" id="f-bitis" placeholder="Bitiş Tarihi" />
    <button type="submit">Kaydet</button>
  </form>

  <!-- Filtreleme -->
  <div class="filter-section">
    <input id="filter-isAdi" placeholder="İş Adına Göre Filtrele" />
    <input id="filter-daire" placeholder="Daireye Göre Filtrele" />
    <button id="apply-filter">Filtre Uygula</button>
  </div>

  <!-- Kayıtlar Tablosu -->
  <table>
    <thead>
      <tr><th>İş Adı</th><th>Daire</th><th>İş Tanımı</th><th>Başlangıç</th><th>Bitiş</th></tr>
    </thead>
    <tbody id="records"></tbody>
  </table>
</body>
</html>
