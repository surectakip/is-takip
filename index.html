<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>İş Takip Sistemi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Mevcut CSS ve JS'ler korunur -->

  <!-- GANTT CHART için eklenen bağlantılar -->
  <link rel="stylesheet" href="https://unpkg.com/frappe-gantt/dist/frappe-gantt.css">
  <script src="https://unpkg.com/frappe-gantt/dist/frappe-gantt.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    /* Gantt çubuğu özel renkleri */
    .bar.done { fill: #2ecc71; }
    .bar.in-progress { fill: #f1c40f; }
    .bar.todo { fill: #e74c3c; }
  </style>
</head>
<body>

  <!-- Mevcut bölümler -->

  <h2>Gantt Takvimi</h2>
  <div id="gantt" style="margin-top: 40px;"></div>

  <!-- Mevcut scriptleriniz korunur -->

  <!-- GANTT CHART JS -->
  <script>
    const sheetURL = "https://script.google.com/macros/s/AKfycbzWHYoTPbmzRhX96TasJVpBq0Oib0MU12bn3uh-WyaAWkLJCtnoSn-ptGqAFPnjh_Gd/exec";

    fetch(sheetURL)
      .then(response => response.json())
      .then(data => {
        const tasks = data
          .filter(row => row[1] && row[10] && row[11])
          .map((row, i) => {
            const start = new Date(row[10]);
            const duration = parseInt(row[11]);
            const end = new Date(start);
            end.setDate(start.getDate() + duration);

            const durum = (row[8] || "").toLowerCase();
            let renk = "todo";
            if (durum.includes("tamam")) renk = "done";
            else if (durum.includes("devam")) renk = "in-progress";

            return {
              id: "task_" + i,
              name: row[1],
              start: start.toISOString().split("T")[0],
              end: end.toISOString().split("T")[0],
              progress: row[12] ? Math.min(100, Math.round((parseInt(row[12]) / duration) * 100)) : 0,
              custom_class: renk
            };
          });

        new Gantt("#gantt", tasks, {
          view_mode: 'Week',
          date_format: 'YYYY-MM-DD'
        });
      })
      .catch(error => {
        document.getElementById("gantt").innerHTML = "<p style='color:red;'>Veri alınamadı: " + error + "</p>";
      });
  </script>

</body>
</html>
